# Nombre del workflow que ver치s en la pesta침a "Actions"
name: Actualizar CSV desde Google Drive

# Define cu치ndo se ejecutar치 la automatizaci칩n
on:
  # A las 00:00 UTC (horario universal) de cada d칤a
  schedule:
    - cron: '0 0 * * *'

  # Permite ejecutarlo manualmente para hacer pruebas
  workflow_dispatch:

# Define las tareas a realizar
jobs:
  actualizar-fichero-csv:
    # La automatizaci칩n se ejecutar치 en un servidor virtual con Ubuntu
    runs-on: ubuntu-latest

    # Permisos para que la acci칩n pueda escribir en tu repositorio
    permissions:
      contents: write

    # Pasos que se seguir치n
    steps:
      # 1. Descarga el c칩digo de tu repositorio al servidor virtual
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      # 2. Descarga el nuevo fichero desde Google Drive y lo reemplaza
      - name: Descargar datos.csv desde Google Drive
        run: |
          # Usamos curl para descargar el fichero del enlace directo
          # La opci칩n -L sigue las redirecciones y -o guarda el contenido en el fichero datos.csv
          curl -L "https://drive.google.com/uc?export=download&id=13tpvR7VdY_iEQ6MPiUo3_25o0cJYubGX" -o datos.csv
          echo "Fichero datos.csv descargado y actualizado."

      # 3. Sube los cambios autom치ticamente a tu repositorio
      - name: Hacer commit y push de los cambios
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Mensaje del commit que ver치s en el historial
          commit_message: '游뱄 Auto: Actualizaci칩n diaria de datos.csv'
          # El fichero que se va a subir. En este caso, datos.csv
          file_pattern: datos.csv
          commit_user_name: GitHub Actions Bot
          commit_user_email: actions@github.com
